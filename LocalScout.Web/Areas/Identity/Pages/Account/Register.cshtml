@page
@model RegisterModel
@{
    ViewData["Title"] = "Register as a User";
    Layout = "_AuthLayout.cshtml";
}

@section LeftPanelLink {
    <p class="m-0">
        Already have an account?
        <a asp-page="./Login" asp-route-returnUrl="@Model.ReturnUrl"
            class="text-white no-underline font-semibold pb-0.5 hover:opacity-80 transition-opacity">Log in here</a>
    </p>
}

<div class="flex gap-2 mb-3">
    <a asp-page="./Register" asp-route-returnUrl="@Model.ReturnUrl"
        class="flex-1 rounded-xl px-3 py-2.5 font-semibold transition-all border-2 bg-gradient-to-br from-blue-500 to-blue-700 text-white border-blue-500 shadow-lg flex items-center justify-center gap-2.5 no-underline text-sm">
        <i class="fas fa-user text-base"></i>
        <span>User</span>
    </a>
    <a asp-page="./RegisterProvider" asp-route-returnUrl="@Model.ReturnUrl"
        class="flex-1 rounded-xl px-3 py-2.5 font-semibold transition-all border-2 border-gray-200 bg-white text-gray-600 hover:border-gray-200 hover:text-gray-600 flex items-center justify-center gap-2.5 no-underline text-sm">
        <i class="fas fa-briefcase text-base"></i>
        <span>Provider</span>
    </a>
</div>

<div class="overflow-hidden" style="max-height: calc(100vh - 160px);">
    <div class="overflow-y-auto h-full scrollbar-none" data-registration-form data-total-steps="2">
        <h3 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-500 to-blue-700 mb-1">
            Register as a User</h3>
        <p class="text-gray-600 text-xs mb-3">Join LocalScout and discover trusted local services</p>

        <!-- Progress Indicator -->
        <div class="flex justify-between mb-4 relative px-4">
            <div class="absolute top-4 left-0 right-0 h-0.5 bg-gray-200 -z-10"></div>
            <div class="absolute top-4 left-0 h-0.5 bg-gradient-to-r from-blue-500 to-blue-700 transition-all duration-400 -z-10"
                id="progressLine" style="width: 0%;"></div>

            <div class="step active flex flex-col items-center flex-1 relative" data-step="1">
                <div
                    class="w-8 h-8 rounded-full border-2 flex items-center justify-center font-bold transition-all relative z-10 text-sm step-circle">
                    <span>1</span>
                </div>
                <div class="mt-1.5 text-[0.7rem] font-medium text-gray-600 text-center step-label">Account</div>
            </div>

            <div class="step flex flex-col items-center flex-1 relative" data-step="2">
                <div
                    class="w-8 h-8 rounded-full border-2 flex items-center justify-center font-bold transition-all relative z-10 text-sm step-circle">
                    <span>2</span>
                </div>
                <div class="mt-1.5 text-[0.7rem] font-medium text-gray-600 text-center step-label">Personal</div>
            </div>
        </div>

        <form id="registerForm" asp-route-returnUrl="@Model.ReturnUrl" method="post" enctype="multipart/form-data">
            <div asp-validation-summary="ModelOnly" class="text-danger" role="alert"></div>

            <!-- Step 1: Account Information -->
            <div class="form-step active" data-step="1">
                <div class="form-group mb-3.5 relative">
                    <label asp-for="Input.FullName" class="font-semibold text-gray-700 mb-1 text-xs block">Full
                        Name <span class="text-red-500">*</span></label>
                    <div class="relative">
                        <i class="fas fa-user absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-500 text-sm"></i>
                        <input asp-for="Input.FullName"
                            class="form-control w-full rounded-lg px-3.5 py-2 border-2 border-gray-200 transition-all text-sm pl-10"
                            placeholder="Enter your full name" minlength="2" maxlength="100" required />
                    </div>
                    <span asp-validation-for="Input.FullName" class="text-danger text-[0.65rem] mt-0.5 block"></span>
                </div>

                <div class="form-group mb-3.5 relative">
                    <label asp-for="Input.Email" class="font-semibold text-gray-700 mb-1 text-xs block">Email
                        Address</label>
                    <div class="relative">
                        <i class="fas fa-envelope absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-500 text-sm"></i>
                        <input asp-for="Input.Email"
                            class="form-control w-full rounded-lg px-3.5 py-2 border-2 border-gray-200 transition-all text-sm pl-10"
                            placeholder="your.email@example.com" autocomplete="username" />
                    </div>
                    <span asp-validation-for="Input.Email" class="text-danger text-[0.65rem] mt-0.5 block"></span>
                </div>

                <div class="form-group mb-3.5 relative">
                    <label asp-for="Input.Password"
                        class="font-semibold text-gray-700 mb-1 text-xs block">Password <span class="text-red-500">*</span></label>
                    <div class="relative">
                        <i class="fas fa-lock absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-500 text-sm"></i>
                        <input asp-for="Input.Password"
                            class="form-control w-full rounded-lg px-3.5 py-2 border-2 border-gray-200 transition-all text-sm pl-10"
                            placeholder="Create a strong password" autocomplete="new-password" type="password"
                            id="passwordInput" minlength="8" maxlength="100" required />
                    </div>
                    <div class="mt-1 h-0.75 bg-gray-200 rounded-sm overflow-hidden hidden" id="passwordStrength">
                        <div class="h-full transition-all rounded-sm" id="passwordStrengthBar"></div>
                    </div>
                    <div class="text-[0.65rem] mt-0.5 font-medium" id="passwordStrengthText"></div>
                    <span asp-validation-for="Input.Password" class="text-danger text-[0.65rem] mt-0.5 block"></span>
                </div>

                <div class="form-group mb-3.5 relative">
                    <label asp-for="Input.ConfirmPassword"
                        class="font-semibold text-gray-700 mb-1 text-xs block">Confirm Password</label>
                    <div class="relative">
                        <i class="fas fa-lock absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-500 text-sm"></i>
                        <input asp-for="Input.ConfirmPassword"
                            class="form-control w-full rounded-lg px-3.5 py-2 border-2 border-gray-200 transition-all text-sm pl-10"
                            placeholder="Re-enter your password" autocomplete="new-password" type="password"
                            id="confirmPasswordInput" />
                    </div>
                    <span asp-validation-for="Input.ConfirmPassword"
                        class="text-danger text-[0.65rem] mt-0.5 block"></span>
                </div>

                <div class="flex gap-2 mt-4">
                    <button type="button"
                        class="flex-1 rounded-lg px-5 py-2.5 font-semibold border-0 transition-all flex items-center justify-center gap-2 cursor-pointer text-sm bg-gradient-to-br from-blue-500 to-blue-700 text-white hover:from-blue-700 hover:to-blue-900 hover:-translate-y-0.5 hover:shadow-lg"
                        onclick="nextStep()">
                        <span>Next</span>
                        <i class="fas fa-arrow-right text-xs"></i>
                    </button>
                </div>
            </div>

            <!-- Step 2: Personal Details -->
            <div class="form-step" data-step="2">
                <div class="form-group mb-3.5 relative">
                    <label asp-for="Input.ProfilePicture" class="font-semibold text-gray-700 mb-1 text-xs block">Profile
                        Picture (Optional)</label>
                    <input asp-for="Input.ProfilePicture" type="file" accept="image/*"
                        class="form-control w-full rounded-lg px-3.5 py-2 border-2 border-gray-200 transition-all text-sm"
                        id="profilePictureInput" />
                    <span asp-validation-for="Input.ProfilePicture" class="text-danger text-[0.65rem] mt-0.5 block"></span>
                </div>

                <div class="grid grid-cols-2 gap-3 mb-3.5">
                    <div class="form-group relative">
                        <label asp-for="Input.DateOfBirth" class="font-semibold text-gray-700 mb-1 text-xs block">Date of
                            Birth <span class="text-red-500">*</span></label>
                        <div class="relative">
                            <i class="fas fa-calendar absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-500 text-sm"></i>
                            <input asp-for="Input.DateOfBirth"
                                class="form-control w-full rounded-lg px-3.5 py-2 border-2 border-gray-200 transition-all text-sm pl-10"
                                type="date" max="@DateTime.Now.AddYears(-18).ToString("yyyy-MM-dd")" required />
                        </div>
                        <span asp-validation-for="Input.DateOfBirth" class="text-danger text-[0.65rem] mt-0.5 block"></span>
                    </div>

                    <div class="form-group relative">
                        <label asp-for="Input.PhoneNumber" class="font-semibold text-gray-700 mb-1 text-xs block">Phone
                            Number</label>
                        <div class="relative">
                            <i class="fas fa-phone absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-500 text-sm"></i>
                            <input asp-for="Input.PhoneNumber"
                                class="form-control w-full rounded-lg px-3.5 py-2 border-2 border-gray-200 transition-all text-sm pl-10"
                                placeholder="Enter your phone number" />
                        </div>
                        <span asp-validation-for="Input.PhoneNumber" class="text-danger text-[0.65rem] mt-0.5 block"></span>
                    </div>
                </div>

                <div class="form-group mb-3.5 relative">
                    <label asp-for="Input.Address"
                        class="font-semibold text-gray-700 mb-1 text-xs block">Address</label>
                    <div class="relative">
                        <i
                            class="fas fa-map-marker-alt absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-500 text-sm"></i>
                        <input asp-for="Input.Address"
                            class="form-control w-full rounded-lg px-3.5 py-2 border-2 border-gray-200 transition-all text-sm pl-10"
                            placeholder="Enter your address" id="addressInput" style="padding-right: 160px;" />
                        <button type="button"
                            class="btn btn-sm btn-outline-primary absolute right-2.5 top-1/2 -translate-y-1/2 z-10 text-[0.7rem] px-2 py-1 rounded-md whitespace-nowrap transition-all"
                            id="useLocationBtn">
                            Use My Location
                        </button>
                    </div>
                    <span asp-validation-for="Input.Address" class="text-danger text-[0.65rem] mt-0.5 block"></span>

                    <!-- Autocomplete dropdown -->
                    <div id="addressSuggestions"
                        class="list-group mt-1 border border-gray-300 rounded-lg shadow-lg bg-white absolute z-[1000] max-h-[200px] overflow-y-auto hidden"
                        style="width: calc(100% - 30px);"></div>

                    <!-- Hidden fields for coordinates -->
                    <input type="hidden" asp-for="Input.Latitude" id="latitudeInput" />
                    <input type="hidden" asp-for="Input.Longitude" id="longitudeInput" />
                </div>

                <div class="form-group mb-3.5 relative">
                    <label asp-for="Input.Gender" class="font-semibold text-gray-700 mb-1 text-xs block">Gender <span class="text-red-500">*</span></label>
                    <div class="flex gap-2 mt-1.5">
                        <div class="flex-1">
                            <input type="radio" asp-for="Input.Gender" value="Male" id="genderMale" class="hidden" />
                            <label for="genderMale"
                                class="flex items-center justify-center px-2 py-2 border-2 border-gray-200 rounded-lg cursor-pointer transition-all font-medium gap-2 text-xs hover:border-blue-500 hover:-translate-y-0.5">
                                <i class="fas fa-mars"></i>
                                <span>Male</span>
                            </label>
                        </div>
                        <div class="flex-1">
                            <input type="radio" asp-for="Input.Gender" value="Female" id="genderFemale"
                                class="hidden" />
                            <label for="genderFemale"
                                class="flex items-center justify-center px-2 py-2 border-2 border-gray-200 rounded-lg cursor-pointer transition-all font-medium gap-2 text-xs hover:border-blue-500 hover:-translate-y-0.5">
                                <i class="fas fa-venus"></i>
                                <span>Female</span>
                            </label>
                        </div>
                        <div class="flex-1">
                            <input type="radio" asp-for="Input.Gender" value="Other" id="genderOther" class="hidden" />
                            <label for="genderOther"
                                class="flex items-center justify-center px-2 py-2 border-2 border-gray-200 rounded-lg cursor-pointer transition-all font-medium gap-2 text-xs hover:border-blue-500 hover:-translate-y-0.5">
                                <i class="fas fa-genderless"></i>
                                <span>Other</span>
                            </label>
                        </div>
                    </div>
                    <span asp-validation-for="Input.Gender" class="text-danger text-[0.65rem] mt-0.5 block"></span>
                </div>

                <div class="flex gap-2 mt-4">
                    <button type="button"
                        class="rounded-lg px-4 py-2.5 font-semibold border-0 transition-all flex items-center justify-center gap-2 cursor-pointer text-sm bg-gray-600 text-white hover:bg-gray-700 hover:-translate-y-0.5 hover:shadow-lg flex-[0_0_90px]"
                        onclick="prevStep()">
                        <i class="fas fa-arrow-left text-xs"></i>
                        <span>Back</span>
                    </button>
                    <button type="submit"
                        class="flex-1 rounded-lg px-5 py-2.5 font-semibold border-0 transition-all flex items-center justify-center gap-2 cursor-pointer text-sm bg-gradient-to-br from-green-500 to-green-700 text-white hover:from-green-700 hover:to-green-900 hover:-translate-y-0.5 hover:shadow-lg"
                        id="submitBtn">
                        <i class="fas fa-check text-xs"></i>
                        <span>Complete Registration</span>
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script type="module" src="~/js/registration-form.js"></script>

    <style>
        /* Step indicator styles with better visibility */
        .step.active .step-circle {
            background-color: #007bff;
            border-color: #007bff;
            color: white;
            transform: scale(1.1);
            box-shadow: 0 0 0 4px rgba(0, 123, 255, 0.15);
            font-weight: 700;
        }

        .step.completed .step-circle {
            background-color: #28a745;
            border-color: #28a745;
            color: white;
            font-weight: 700;
        }

        .step.active .step-label {
            color: #007bff;
            font-weight: 600;
        }

        .step-circle {
            font-size: 0.875rem;
            line-height: 1;
            background-color: #ffffff;
            border-color: #e5e7eb;
            color: #4b5563;
        }

        /* Gender radio button checked state */
        input[type="radio"]:checked+label {
            border-color: #007bff !important;
            background-color: rgba(0, 123, 255, 0.05);
            color: #007bff;
        }

        /* Password strength show state */
        #passwordStrength.show {
            display: block !important;
        }

        /* Scrollbar hide */
        .scrollbar-none::-webkit-scrollbar {
            width: 0px;
            background: transparent;
        }

        .scrollbar-none {
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        /* Address suggestions styling */
        #addressSuggestions .list-group-item {
            border: none;
            border-bottom: 1px solid #f1f1f1;
            padding: 10px 12px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        #addressSuggestions .list-group-item:last-child {
            border-bottom: none;
        }

        #addressSuggestions .list-group-item:hover {
            background-color: #f8f9fa;
            transform: translateX(4px);
        }

        #addressSuggestions .list-group-item i {
            color: #007bff;
        }
    </style>
}