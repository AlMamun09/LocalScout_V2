@page
@model ResetPasswordModel
@{
  ViewData["Title"] = "Reset Password";
  Layout = "_AuthLayout.cshtml";
}

@section Styles {
  <link rel="stylesheet" href="~/css/auth.css" asp-append-version="true" />
}

@section LeftPanelLink {
  <p style="margin: 0;">
    Remember your password?
    <a asp-page="./Login">Log in here</a>
  </p>
}

<div class="fade-in">
  <h3 class="auth-heading">Reset Your Password</h3>
  <p class="auth-subheading">Enter your new password below</p>

  <form method="post">
    <div asp-validation-summary="ModelOnly" class="text-danger" role="alert"></div>
    <input asp-for="Input.Code" type="hidden" />

    <div class="form-group">
      <label asp-for="Input.Email">Email Address</label>
      <div class="input-with-icon">
        <i class="fas fa-envelope"></i>
        <input asp-for="Input.Email" class="form-control" autocomplete="username"
          placeholder="your.email@example.com" />
      </div>
      <span asp-validation-for="Input.Email" class="text-danger"></span>
    </div>

    <div class="form-group">
      <label asp-for="Input.Password">New Password</label>
      <div class="input-with-icon">
        <i class="fas fa-lock"></i>
        <input asp-for="Input.Password" class="form-control" type="password" autocomplete="new-password"
          placeholder="Enter new password" id="passwordInput" />
      </div>
      <div class="password-strength" id="passwordStrength">
        <div class="password-strength-bar" id="passwordStrengthBar"></div>
      </div>
      <div class="password-strength-text" id="passwordStrengthText"></div>
      <span asp-validation-for="Input.Password" class="text-danger"></span>
    </div>

    <div class="form-group">
      <label asp-for="Input.ConfirmPassword">Confirm New Password</label>
      <div class="input-with-icon">
        <i class="fas fa-lock"></i>
        <input asp-for="Input.ConfirmPassword" class="form-control" type="password" autocomplete="new-password"
          placeholder="Confirm new password" id="confirmPasswordInput" />
      </div>
      <span asp-validation-for="Input.ConfirmPassword" class="text-danger"></span>
    </div>

    <div class="form-group">
      <button type="submit" class="btn btn-submit" style="width: 100%;">
        <i class="fas fa-check"></i>
        Reset Password
      </button>
    </div>
  </form>
</div>

@section Scripts {
  <partial name="_ValidationScriptsPartial" />
  <script>
    // Password strength indicator
    const passwordInput = document.getElementById('passwordInput');
    const strengthBar = document.getElementById('passwordStrengthBar');
    const strengthText = document.getElementById('passwordStrengthText');
    const strengthContainer = document.getElementById('passwordStrength');
    const confirmPassword = document.getElementById('confirmPasswordInput');

    passwordInput.addEventListener('input', function () {
      const password = this.value;

      if (password.length === 0) {
        strengthContainer.classList.remove('show');
        return;
      }

      strengthContainer.classList.add('show');

      let strength = 0;
      if (password.length >= 8) strength += 25;
      if (/[a-z]/.test(password)) strength += 25;
      if (/[A-Z]/.test(password)) strength += 25;
      if (/[0-9]/.test(password) || /[^A-Za-z0-9]/.test(password)) strength += 25;

      strengthBar.style.width = strength + '%';

      if (strength <= 25) {
        strengthBar.style.backgroundColor = '#dc3545';
        strengthText.style.color = '#dc3545';
        strengthText.textContent = 'Weak';
      } else if (strength <= 50) {
        strengthBar.style.backgroundColor = '#ffc107';
        strengthText.style.color = '#ffc107';
        strengthText.textContent = 'Fair';
      } else if (strength <= 75) {
        strengthBar.style.backgroundColor = '#17a2b8';
        strengthText.style.color = '#17a2b8';
        strengthText.textContent = 'Good';
      } else {
        strengthBar.style.backgroundColor = '#28a745';
        strengthText.style.color = '#28a745';
        strengthText.textContent = 'Strong';
      }
    });

    // Confirm password validation
    confirmPassword.addEventListener('input', function () {
      if (this.value && this.value === passwordInput.value) {
        this.classList.remove('is-invalid');
        this.classList.add('is-valid');
      } else if (this.value) {
        this.classList.add('is-invalid');
        this.classList.remove('is-valid');
      }
    });
  </script>
}