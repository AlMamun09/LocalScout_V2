@using Microsoft.AspNetCore.Identity
@using LocalScout.Domain.Entities
@using LocalScout.Infrastructure.Constants
@inject UserManager<ApplicationUser> UserManager
@inject SignInManager<ApplicationUser> SignInManager

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - LocalScout</title>

    <!-- Bootstrap 4.6 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" />
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <!-- Tailwind Config (must load before CDN) -->
    <script src="~/tailwind.config.js"></script>
    <!-- Tailwind CSS v3 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="~/css/custom-theme.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />

    @await RenderSectionAsync("Styles", required: false)
</head>

<body class="d-flex flex-column min-vh-100">

    <!-- Main Header/Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom shadow-sm sticky-top">
        <div class="container-fluid px-4">

            <!-- Brand Logo -->
            <a class="navbar-brand d-flex align-items-center" asp-area="" asp-controller="Home" asp-action="Index">
                <img src="~/images/LocalScoutLogo.png" alt="LocalScout Logo"
                    style="height: 35px; width: auto; margin-right: 10px;" />

                <span class="localscout-logo">LocalScout</span>
            </a>

            <!-- Mobile Toggle Button -->
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#mainNavbar"
                aria-controls="mainNavbar" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <!-- Navbar Content -->
            <div class="collapse navbar-collapse" id="mainNavbar">

                <!-- Left Spacer -->
                <ul class="navbar-nav mr-auto"></ul>

                <!-- Center Search Bar (Hidden on Home Page) -->
                @if (!(ViewData["HideNavbarSearch"] is bool hide && hide))
                {
                    <div class="d-none d-md-flex justify-content-center flex-grow-1 mx-3">
                        <form class="d-flex my-2 my-lg-0" style="max-width: 450px; width: 100%;" role="search"
                            asp-controller="Home" asp-action="Search" method="get">
                            <div class="input-group">
                                <input class="form-control" type="search" name="query" placeholder="Search for services..."
                                    aria-label="Search">
                                <div class="input-group-append">
                                    <button class="btn btn-primary" type="submit">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                }

                <!-- Right Side: User/Login (IMPORTANT: No display:none or visibility issues) -->
                <ul class="navbar-nav ml-auto align-items-center"
                    style="visibility: visible !important; display: flex !important;">
                    <partial name="_LoginPartial" />
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-shrink-0">
        @RenderBody()
    </main>

    <!-- Footer -->
    <footer class="bg-light border-top mt-auto py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-3">
                    <h5 class="text-primary">LocalScout</h5>
                    <p class="text-muted small">
                        Connecting you with trusted local service providers in your area.
                    </p>
                </div>
                <div class="col-md-4 mb-3">
                    <h6>Quick Links</h6>
                    <ul class="list-unstyled">
                        <li><a href="#" class="text-decoration-none text-muted">About Us</a></li>
                        <li><a href="#" class="text-decoration-none text-muted">Services</a></li>
                        <li><a href="#" class="text-decoration-none text-muted">Contact</a></li>
                        <li>
                            <a asp-area="" asp-controller="Home" asp-action="Privacy"
                                class="text-decoration-none text-muted">Privacy Policy</a>
                        </li>
                    </ul>
                </div>
                <div class="col-md-4 mb-3">
                    <h6>Connect With Us</h6>
                    <div class="d-flex">
                        <a href="#" class="btn btn-outline-secondary btn-sm mr-2"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="btn btn-outline-secondary btn-sm mr-2"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="btn btn-outline-secondary btn-sm mr-2"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="btn btn-outline-secondary btn-sm"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
            </div>
            <hr class="my-3">
            <div class="text-center text-muted small">
                &copy; 2025 LocalScout. All rights reserved.
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <!-- Popper.js v1 for Bootstrap 4 -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <!-- Bootstrap 4.6 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>

    <!-- Debug Script -->
    <script>
        $(document).ready(function() {
            console.log('Layout loaded');
            console.log('jQuery loaded:', typeof $ !== 'undefined');
            console.log('Bootstrap loaded:', typeof $.fn.modal !== 'undefined');
            console.log('LoginPartial container:', $('.navbar-nav.ml-auto').length);
            console.log('LoginPartial HTML:', $('.navbar-nav.ml-auto').html());
        });
    </script>

    @await RenderSectionAsync("Scripts", required: false)
</body>

</html>