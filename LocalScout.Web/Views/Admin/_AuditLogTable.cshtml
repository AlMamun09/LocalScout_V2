@model LocalScout.Application.DTOs.AuditDTOs.AuditLogPagedResultDto

@{
    var filter = Model?.AppliedFilters;
    var itemCount = Model?.Items?.Count ?? 0;
}

<div class="card-header">
    <h3 class="card-title">
        <i class="fas fa-list mr-2"></i>
        <span id="events-count">@itemCount</span> Events Loaded
    </h3>
</div>
<div class="card-body table-responsive p-0">
    @if (Model?.Items != null && Model.Items.Any())
    {
        <table class="table table-hover table-striped audit-table">
            <thead class="thead-light">
                <tr>
                    <th>Timestamp</th>
                    <th>User</th>
                    <th>Category</th>
                    <th>Action</th>
                    <th>Details</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="audit-log-tbody">
                @foreach (var log in Model.Items)
                {
                    var categoryBadge = log.Category switch
                    {
                        "Authentication" => "badge-primary",
                        "UserManagement" => "badge-info",
                        "ProviderManagement" => "badge-success",
                        "Booking" => "badge-warning",
                        "Payment" => "badge-danger",
                        "Service" => "badge-secondary",
                        "Review" => "badge-info",
                        "Report" => "badge-dark",
                        _ => "badge-light"
                    };

                    <tr>
                        <td class="text-nowrap">
                            <small>
                                @log.Timestamp.ToLocalTime().ToString("MMM dd, yyyy")<br/>
                                <span class="text-muted">@log.Timestamp.ToLocalTime().ToString("HH:mm:ss")</span>
                            </small>
                        </td>
                        <td>
                            @if (!string.IsNullOrEmpty(log.UserName))
                            {
                                <span class="font-weight-bold">@log.UserName</span>
                                <br/><small class="text-muted">@log.UserEmail</small>
                            }
                            else
                            {
                                <span class="text-muted">System</span>
                            }
                        </td>
                        <td>
                            <span class="badge @categoryBadge badge-category">@log.Category</span>
                        </td>
                        <td>
                            <strong>@log.Action</strong>
                        </td>
                        <td class="audit-details" title="Click to view full details">
                            @(string.IsNullOrEmpty(log.Details) ? "-" : (log.Details.Length > 50 ? log.Details.Substring(0, 50) + "..." : log.Details))
                        </td>
                        <td>
                            @if (log.IsSuccess)
                            {
                                <span class="badge badge-success"><i class="fas fa-check"></i></span>
                            }
                            else
                            {
                                <span class="badge badge-danger"><i class="fas fa-times"></i></span>
                            }
                        </td>
                        <td>
                            <button type="button" class="btn btn-xs btn-info view-log-details"
                                    data-log-id="@log.AuditLogId"
                                    data-timestamp="@log.Timestamp.ToLocalTime().ToString("MMM dd, yyyy HH:mm:ss")"
                                    data-user-name="@log.UserName"
                                    data-user-email="@log.UserEmail"
                                    data-category="@log.Category"
                                    data-action="@log.Action"
                                    data-entity-type="@log.EntityType"
                                    data-entity-id="@log.EntityId"
                                    data-details="@log.Details"
                                    data-ip="@log.IpAddress"
                                    data-success="@log.IsSuccess.ToString().ToLower()"
                                    title="View Details">
                                <i class="fas fa-eye"></i>
                            </button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <div class="text-center p-5 text-muted">
            <i class="fas fa-clipboard fa-4x mb-3"></i>
            <p>No audit log entries found.</p>
            <p class="small">Audit events will appear here once actions are logged.</p>
        </div>
    }
</div>

@if (Model?.Items != null && Model.Items.Count >= 25)
{
    <div class="card-footer text-center" id="load-more-container">
        <button type="button" id="load-more-btn" class="btn btn-outline-primary" data-page="2">
            <i class="fas fa-plus-circle mr-2"></i>Load More
        </button>
        <span id="loading-spinner" class="d-none">
            <i class="fas fa-spinner fa-spin mr-2"></i>Loading...
        </span>
        <div id="no-more-data" class="text-muted d-none">
            <i class="fas fa-check-circle mr-2"></i>All records loaded
        </div>
    </div>
}
